<!DOCTYPE html>
<html lang="en">
<head>
	<style>
        .title {
            padding: 0 16px;
            line-height: 48px;
            color: rgba(5, 0, 56, 1);
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            font-family: Formular, sans-serif;
            font-size: 16px;
            font-weight: 500;
        }

        .imageItem {
            padding: 8px;
            cursor: pointer;
            font-family: Formular, sans-serif;
        }

        .imageItem:hover {

        }
	</style>
</head>
<body>
<div class="title">Cardographer Upload</div>
<div id="warning"></div>
<div id="missingTitles">
</div>
<button id="upload">Upload</button>
<script src="https://miro.com/app/static/sdk.1.1.js"></script>
<script defer>
	miro.onReady(() => {
		miro.addListener(miro.enums.event.SELECTION_UPDATED, getWidget)
		getWidget()
	})

	document.getElementById('upload').addEventListener('click', () => {
		upload()
	})

	const imageList = document.getElementById('missingTitles')
	const warning = document.getElementById('warning')

	async function getWidget() {
		const objects = await miro.board.widgets.get()

		console.log(objects)
		const untitled = objects
			.filter((widget) => widget.type === "IMAGE" && widget.url === '' && widget.title === '')

		if (untitled.length > 0) {
			warning.innerText = untitled.length + " images need titles before uploading"
			warning.style.opacity = '1'

			imageList.innerHTML = ''
			untitled.forEach((image) => {
				const imageElement = document.createElement('div')
				imageElement.innerText = 'Image ' + image.id
				imageElement.classList.add('imageItem')
				imageElement.addEventListener('click', async () => {
					await miro.board.selection.selectWidgets(image.id)
				})

				imageList.append(imageElement)
			})

		} else {
			warning.style.opacity = '0'
			imageList.innerHTML = ''
		}
	}

	async function upload() {

	}
</script>
</body>
</html>